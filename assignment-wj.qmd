---
title: "Assignment-Wj"
author: "Wujie"
format: html
editor: visual
---

## 

# Import library

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)

```

## Read csv

```{r}
# Read the data
yearly_rate <- read_csv("M212941.csv", skip = 9)
month_rate <- read_csv("M212911.csv", skip = 10)
month_rate <- month_rate[1:152,]

# Filter the data to include only the first 152 rows
yearly_rate <- yearly_rate[1:152,]

# Filter the data for the years 2019 ,2020 ,2021, 2022, and 2023
# base year are 2019
yearly_data <- yearly_rate %>%
  filter(`Data Series` %in% c("Food", "Food Excl Food Serving Services", "Clothing & Footwear", "Housing & Utilities", "Household Durables & Services", "Health Care", "Transport", "Communication", "Recreation & Culture", "Education", "Miscellaneous Goods & Services", "All Items")) %>%
  select(`Data Series`, `2019`,`2020`,`2021`, `2022`, `2023`)
```

```{r}
yearly_data
# print column name
print(colnames(yearly_data))
yearly_data <- yearly_data %>%
  mutate(`2019` = as.numeric(`2019`),
         `2020` = as.numeric(`2020`),
         `2021` = as.numeric(`2021`),
         `2022` = as.numeric(`2022`),
         `2023` = as.numeric(`2023`))

```

```{r}
long_yearly_data <- yearly_data %>%
  pivot_longer(cols = c(`2019`, `2020`, `2021`, `2022`, `2023`), names_to = "Year", values_to = "Rate_Change") %>%
  mutate(Year = as.integer(Year))
```

```{r}
# Filter for the years 2019 to 2023 (already done implicitly by selecting these columns)
filtered_long_yearly_data <- long_yearly_data %>%
  filter(Year >= 2019 & Year <= 2023)

# Create the plot
ggplot(filtered_long_yearly_data, aes(x = Year, y = Rate_Change, color = `Data Series`)) +
  geom_line() +
  geom_point() +
  labs(title = "PPI Rate Change from 2019 to 2023",
       x = "Year",
       y = "Rate Change (%)",
       color = "Data Series") +
  theme_minimal()
```

```{r}

# Filter for the year 2023 only
filtered_long_yearly_data <- long_yearly_data %>%
  filter(Year == 2023)

# Calculate total change for each Data Series
total_change <- long_yearly_data %>%
  filter(Year %in% c(2019, 2023)) %>%
  group_by(`Data Series`) %>%
  summarize(Total_Change = Rate_Change[Year == 2023] - Rate_Change[Year == 2019])

# Merge total change with the filtered data
filtered_long_yearly_data <- filtered_long_yearly_data %>%
  left_join(total_change, by = "Data Series")

# Create the bar graph with different colors for each category
ggplot(filtered_long_yearly_data, aes(x = `Data Series`, y = Rate_Change, fill = `Data Series`)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = paste0(round(Rate_Change, 1), "%")),
            position = position_dodge(width = 0.9), vjust = -0.5, size = 3, color = "black") +
  labs(title = "CPI Rate Change in 2023 Compared to 2019",
       x = "Data Series",
       y = "Rate Change (%)",
       fill = "Data Series") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels for better readability
        legend.position = "none", # Remove legend since each bar is color-coded
        plot.title = element_text(hjust = 0.5), # Center the plot title
        axis.text = element_text(size = 10), # Increase axis text size
        axis.title = element_text(size = 12)) # Increase axis title size
```

```{r}

# Filter for the years 2019 and 2023
filtered_long_yearly_data <- long_yearly_data %>%
  filter(Year %in% c(2019, 2023))

# Create the lollipop chart
ggplot(filtered_long_yearly_data, aes(x = `Data Series`, y = Rate_Change, color = factor(Year))) +
  geom_segment(aes(x = `Data Series`, xend = `Data Series`, y = 0, yend = Rate_Change), size = 1) +
  geom_point(size = 4) +
  labs(title = "CPI Rate Change: 2019 vs 2023",
       x = "Data Series",
       y = "Rate Change (%)",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels for better readability
        plot.title = element_text(hjust = 0.5),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12),
        legend.position = "bottom")
```

```{r}

# Filter for the years 2019 to 2023
filtered_long_yearly_data <- long_yearly_data %>%
  filter(Year %in% c(2019, 2020, 2021, 2022, 2023))

# Create the line graph without points
ggplot(filtered_long_yearly_data, aes(x = Year, y = Rate_Change, color = `Data Series`, group = `Data Series`)) +
  geom_line(size = 1) +
  labs(title = "CPI Rate Change from 2019 to 2023",
       x = "Year",
       y = "Rate Change (%)",
       color = "Data Series") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12),
        legend.position = "bottom") +
  scale_x_continuous(breaks = seq(2019, 2023, 1)) # Ensure all years are shown on the x-axis
```

```{r}
month_rate <- month_rate %>%
  mutate(across(matches("^2019|^2020|^2021|^2022|^2023"), as.numeric))
month_data <- month_rate %>%
  filter(`Data Series` %in% c("Food", "Food Excl Food Serving Services", "Clothing & Footwear", "Housing & Utilities", "Household Durables & Services", "Health Care", "Transport", "Communication", "Recreation & Culture", "Education", "Miscellaneous Goods & Services", "All Items")) %>%
  select(`Data Series`, matches("^2019|^2020|^2021|^2022|^2023"))

```

```{r}

# Reshape the data from wide to long format
long_month_data <- month_data %>%
  pivot_longer(cols = matches("^2019|^2020|^2021|^2022|^2023"), 
               names_to = "Year_Month", values_to = "Rate_Change") %>%
  separate(Year_Month, into = c("Year", "Month"), sep = " ") %>%
  mutate(Year = as.integer(Year), 
         Month = factor(Month, levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")),
         Date = as.Date(paste(Year, Month, "01", sep = "-"), format = "%Y-%b-%d"))

# Create the line graph
ggplot(long_month_data, aes(x = Date, y = Rate_Change, color = `Data Series`, group = `Data Series`)) +
  geom_line(size = 1) +
  labs(title = "Monthly CPI Rate Change from January 2019 to December 2023",
       x = "Date",
       y = "Rate Change (%)",
       color = "Data Series") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels for better readability
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12),
        legend.position = "bottom")
```
